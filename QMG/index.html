<!DOCTYPE html>
<html lang="en">
<head>
	<title>Dexrn's Hell Hole > QMG File Format Research</title>
    <link id="theme" rel="stylesheet" href="">
	<link id="theme" rel="stylesheet" href="/css/all.css">
    <script src="../js/settings.js"></script>
	<meta content="Dexrn's Hell Hole > QMG File Format Research" property="og:title"/>
	<meta content="The QMG File Format Reverse Engineering Project" property="og:description"/>
	<meta content="https://DexrnZacAttack.github.io" property="og:url"/>
	<meta content="https://github.com/DexrnZacAttack/QmageDecoder/blob/main/QMGDecoderIcon.png?raw=true" property="og:image"/>
	<meta content="#0078D7" data-react-helmet="true" name="theme-color"/>
	<meta charset="utf-8">
	<meta name="description" content="The QMG File Format Reverse Engineering Project">
	<link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/DexrnZacAttack/DexrnZacAttack.github.io/main/assets/favicon.png">
	<script src="../js/background.js"></script>
	<script src="../js/fadeout.js"></script>
</head>
<body>
	<div class="loadingScreen">
		<div class="loading">
			<img id="lightLSpinner" src="../assets/loader.gif">
			<img id="darkLSpinner" src="../assets/loader-dark.gif">
		</div>
	</div>
<div class="mainContent">
    <div class="bg">
        <div class="wrapper" id="wrapper">
            <div class="card readingcard" style="cursor: pointer; width: 70%;" id="back" linkto="../index.html">
            <div class="back" id="backbtn"></div>
            </div>
            <div class="card readingcard" style="width: 70%; h1, h2, h3, p {margin-block: 10px;}">
            <div class="card-title" id="qmgr-path"></div>
        <h3>Introduction</h3>
			<p><b>QMG is a file format made by Quram which is meant to be a faster, less space-expensive alternative to PNG, with one of the main selling points being compression without the major loss of resolution. Samsung uses this format for assets, such as the boot animation, and images in APKs.</b></p>
			<p>This investigation is ongoing, more information will be added to this webpage as we find out new things.</p>
			<p>Alot of the information we got was from this <a href="https://googleprojectzero.blogspot.com/2020/07/mms-exploit-part-1-introduction-to-qmage.html">website.</a></p>
			<p><b>If you have ANY information about the QMG format, please contact me here: <a href="https://forum.xda-developers.com/m/dexrn.10032235">XDA Developers Forum</a></b></p>
		    <h3><a href="https://github.com/DexrnZacAttack/QmageDecoder">https://github.com/DexrnZacAttack/QmageDecoder</a></h3>
		<hr id="dark">
		<h3>01/06/2024</h3>
		<hr id="dotted">
		    <p><b>Where have we been?</b></p>
		    <p>While there isnt much activity happening at the moment, the project is still being thought about.</p>
		    <p>Currently we have a working QG decoder, but we need to make instructions and figure out how to organize it.</p>
		    <p><b>At the moment, the file structure looks like this:</b></p>
		    <img src="https://github.com/DexrnZacAttack/DexrnZacAttack.github.io/blob/main/assets/QMG/Dexrn_explorer_TIlqSUDAeK_01-06-2024_03_06_20_477_PM.png?raw=true" width="481" height="165">
		    <p>I have been debating for a while whether to keep it this way or not.</p>
		<hr id="dark">
		<h3>11/13/2023</h3>
		<hr id="dotted">
		    <p><b>Here are a bunch of propriatary files, in theory the Samsung Internet browser should be able to embed them.</b></p>
			<p>Note that the un-embedded ones will just be text.</p>
		    <p>QM:</p>
		    <img src="https://raw.githubusercontent.com/DexrnZacAttack/DexrnZacAttack.github.io/main/assets/QMG/EmbedTest/BST_bootsamsung.qmg" alt="Embedded QM">
		    <p>QG:</p>
		    <img src="https://raw.githubusercontent.com/DexrnZacAttack/DexrnZacAttack.github.io/main/assets/QMG/EmbedTest/bugdroid.qmg" alt="Embedded QG">
		    <p>SPR (BMP):</p>
		    <img src="https://raw.githubusercontent.com/DexrnZacAttack/DexrnZacAttack.github.io/main/assets/QMG/EmbedTest/test.bmp" alt="Embedded SPR (BMP)">
		    <p>SPR:</p>
		    <img src="https://raw.githubusercontent.com/DexrnZacAttack/DexrnZacAttack.github.io/main/assets/QMG/EmbedTest/tw_numberpicker_prev_mtrl.spr" alt="Embedded SPR">
		<hr id="full">    
		<h3>11/02/2023</h3>
		<hr id="dotted">
		      <p>We found about a new file format, SPR (Thanks GenericPnPMonitor)</p>
		      <p>There is also a propriatary BMP format they use which also uses the same SPR header, and is probably just the same file format with a different extension.</p>
		      <p>By the looks of it, Skia should be able to decode it too... However our current code doesnt seem to work with it.</p>
		<hr id="full">
		<h3>10/28/2023</h3>
		<hr id="dotted">
		      <p>We now have access to aarch64 and aarch32 hardware!</p>
		      <p>Thanks CarPBon and NeRdTheNed!</p>
		<hr id="full">
		<h3>10/20/2023</h3>
		<hr id="dotted">
			<p><b>Animated QM files can now be decoded! (NeRdTheNed got it working!)</b></p>
			<p>Currently the code isnt finished so if you build and test it there might be some issues, but the fact that it works is insane and so amazing to me.</p>
			<img class="imgcontaineralt" src="https://github.com/DexrnZacAttack/DexrnZacAttack.github.io/blob/main/assets/QMG/bootsamsung.gif?raw=true" width="200" height="320">
			<h3><a href="https://github.com/DexrnZacAttack/QmageDecoder">https://github.com/DexrnZacAttack/QmageDecoder</a></h3>
		<hr id="full">
		<h3>10/16/2023</h3>
		<hr id="dotted">
			<p>There is now code in the repo to find and extract all ZLib headers and decompress them.</p>
			<p><b><a href="https://github.com/DexrnZacAttack/QmageDecoder/blob/main/QMG-ExtractAndDecompressZLib">https://github.com/DexrnZacAttack/QmageDecoder/blob/main/QMG-ExtractAndDecompressZLib</a></b></p>
			<p>Note: this extractor is made with some ChatGPT and some of me trying to understand what the fuck I am doing, all at 5 AM. I'm not very good at C/C++.</p>
		<hr id="full">
		<h3>10/14/2023</h3>
		<hr id="dotted">
			<p><b>Found out that QMG files (atleast the static ones) use ZLib compression. (Thanks NeRdTheNed)</b></p>
			<p>We were able to decompress it and got a sort of readable image</p>
			<img src="https://github.com/DexrnZacAttack/DexrnZacAttack.github.io/blob/main/assets/QMG/bugdroid-rawpixels.png?raw=true">
			<p><a href="https://raw.githubusercontent.com/DexrnZacAttack/DexrnZacAttack.github.io/main/assets/QMG/bugdroid.qmg">Original QMG File</a></p>
			<p>The fact that we can even see the image is insane to me.</p>
			<p>As you can see it is a little distorted though, since we do not yet know how to get the colors.</p>
			<br>
			<p><b>How to get a sort of readable image from a Static QMG file</b></p>
			<p>1 - Grab your QMG of choice, must start with QG in the header.</p>
			<p>2 - Flate' it with zlib-flate</p>
			<p>3 - Put it into https://rawpixels.net/ to see the image data.</p>
			<br>
			<p><b>We are still working on finding out how to get proper colors and getting animations as well.</b></p>
		<hr id="full">
		<h3>7/9/2023</h3>
		<hr id="dotted">
			<p><b>Header of bootsamsung.qmg from the SM-T280</b></p>
			<img src="https://raw.githubusercontent.com/DexrnZacAttack/DexrnZacAttack.github.io/main/assets/QMG/QMG-SMT280-HEADER.png" alt="Header of bootsamsung.qmg from the SM-T280">
			<p><b>How can we attempt to read this QMG Animation file?</b></p>
			<p>First, to get a "preview" of the animation's frames, we can open the file in a <a href="https://rawpixels.net">raw data to image viewer</a></p>
                  	<p>Make sure you use these settings: RGB565, Little Endian</p>
			<br>
			<p><b>Here is what we got from doing that</b></p>
			<img src="https://raw.githubusercontent.com/DexrnZacAttack/DexrnZacAttack.github.io/main/assets/QMG/rawpixels.png">
			<p>It may not look like much, but the purple and orange pixels are the frames of the animation, unfortunately they are compressed or something... (Yep it is... Thanks NeRdTheNed!)</p>
			<p>Note: I didn't show the full image due to the full image being very tall</p>
			<p><b>I decided to try a different QMG file... this time from the Note 5.</b></p>
			<p>What I found out is that there are different versions of the QMG boot animation file, with the SM-T280's being a variation of (or most similar to) bootsamsungmini.qmg</p>
			<img src="https://raw.githubusercontent.com/DexrnZacAttack/DexrnZacAttack.github.io/main/assets/QMG/FileVariations.png">
		<hr id="full">
		<h3>6/28/2023</h3>
		<hr id="dotted">
			<!--- D: Header Info --->
			<p><b>Header</b></p>
			<p>The header of a QMG file contains basic information like the resolution, quality, and version.</p>
			<p>Note: this seems to be the header for the static version of the QMG format, I will try to update this and add/replace with the animation version's header.</p>
			<!--- D: ewwww --->
			<!--- D: Tried to make it a little bit nicer to look at... --->
						 <table style="border-collapse: collapse; border: none; table-layout: fixed; width: 100%;">
							<colgroup>
								<col>
								<col>
								<col>
								<col>
								<col>
								<col>
								<col>
								<col>
								<col>
								<col>
								<col>
								<col>
							</colgroup>
							<tbody>
								<tr style="height: 21pt;">
									<td colspan="2" style="background-color: #d9d9d9; color:black; border: solid #000000 1pt; padding: 5pt; vertical-align: top;">
										<div dir="ltr" style="line-height: 1.2; text-align: center;">
											<span style="background-color: transparent; color: black;">Magic</span>
										</div>
									</td>
									<td colspan="3" style="background-color: #d9d9d9; color:black; border: solid #000000 1pt; padding: 5pt; vertical-align: top;">
										<div dir="ltr" style="line-height: 1.2; text-align: center;">
											<span style="background-color: transparent; color: black;">Version</span>
										</div>
									</td>
									<td style="background-color: #d9d9d9; color:black; border: solid #000000 1pt; padding: 5pt; vertical-align: top;">
										<div dir="ltr" style="line-height: 1.2; text-align: center;">
											<span style="background-color: transparent; color: black;">Flags</span>
										</div>
									</td>
									<td style="background-color: #d9d9d9; color:black; border: solid #000000 1pt; padding: 5pt; vertical-align: top;">
										<div dir="ltr" style="line-height: 1.2; text-align: center;">
											<span style="background-color: transparent; color: black;">Qual.</span>
										</div>
									</td>
									<td colspan="2" style="background-color: #d9d9d9; color:black; border: solid #000000 1pt; padding: 5pt; vertical-align: top;">
										<div dir="ltr" style="line-height: 1.2; text-align: center;">
											<span style="background-color: transparent; color: black;">Width</span>
										</div>
									</td>
									<td colspan="2" style="background-color: #d9d9d9; color:black; border: solid #000000 1pt; padding: 5pt; vertical-align: top;">
										<div dir="ltr" style="line-height: 1.2; text-align: center;">
											<span style="background-color: transparent; color: black;">Height</span>
										</div>
									</td>
									<td style="background-color: #d9d9d9; color:black; border: solid #000000 1pt; padding: 5pt; vertical-align: top;">
										<div dir="ltr" style="line-height: 1.2; text-align: center;">
											<span style="background-color: transparent; color: black;">Extra</span>
										</div>
									</td>
								</tr>
								<tr style="height: 0pt;">
									<td style="border: solid #000000 1pt; padding: 5pt; vertical-align: top;">
										<div dir="ltr" style="line-height: 1.2; text-align: center;">
											<span class="a">'Q'</span>
										</div>
									</td>
									<td style="border: solid #000000 1pt; padding: 5pt; vertical-align: top;">
										<div dir="ltr" style="line-height: 1.2; text-align: center;">
											<span class="a">'G'</span>
										</div>
									</td>
									<td style="border: solid #000000 1pt; padding: 5pt; vertical-align: top;">
										<div dir="ltr" style="line-height: 1.2; text-align: center;">
											<span class="a">0x01</span>
										</div>
									</td>
									<td style="border: solid #000000 1pt; padding: 5pt; vertical-align: top;">
										<div dir="ltr" style="line-height: 1.2; text-align: center;">
											<span class="a">0x01</span>
										</div>
									</td>
									<td style="border: solid #000000 1pt; padding: 5pt; vertical-align: top;">
										<div dir="ltr" style="line-height: 1.2; text-align: center;">
											<span class="a">0x01</span>
										</div>
									</td>
									<td style="border: solid #000000 1pt; padding: 5pt; vertical-align: top;">
										<div dir="ltr" style="line-height: 1.2; text-align: center;">
											<span class="a">0x28</span>
										</div>
									</td>
									<td style="border: solid #000000 1pt; padding: 5pt; vertical-align: top;">
										<div dir="ltr" style="line-height: 1.2; text-align: center;">
											<span class="a">0x5B</span>
										</div>
									</td>
									<td style="border: solid #000000 1pt; padding: 5pt; vertical-align: top;">
										<div dir="ltr" style="line-height: 1.2; text-align: center;">
											<span class="a">0x58</span>
										</div>
									</td>
									<td style="border: solid #000000 1pt; padding: 5pt; vertical-align: top;">
										<div dir="ltr" style="line-height: 1.2; text-align: center;">
											<span class="a">0x01</span>
										</div>
									</td>
									<td style="border: solid #000000 1pt; padding: 5pt; vertical-align: top;">
										<div dir="ltr" style="line-height: 1.2; text-align: center;">
											<span class="a">0x58</span>
										</div>
									</td>
									<td style="border: solid #000000 1pt; padding: 5pt; vertical-align: top;">
										<div dir="ltr" style="line-height: 1.2; text-align: center;">
											<span class="a">0x01</span>
										</div>
									</td>
									<td style="border: solid #000000 1pt; padding: 5pt; vertical-align: top;">
										<div dir="ltr" style="line-height: 1.2; text-align: center;">
											<span class="a">0x00</span>
										</div>
									</td>
								</tr>
								<tr style="height: 21pt;">
									<td colspan="12" style="background-color: #efefef; color:black; border: solid #000000 1pt; padding: 5pt; vertical-align: top;">
										<div dir="ltr" style="line-height: 1.2; text-align: center;">
											<span style="background-color: transparent; color: black;">Interpreted as:</span>
										</div>
									</td>
								</tr>
								<tr style="height: 21pt;">
									<td colspan="2" style="border: solid #000000 1pt; padding: 5pt; vertical-align: top;">
										<div dir="ltr" style="line-height: 1.2; text-align: center;">
											<span class="a">QG</span>
										</div>
									</td>
									<td colspan="3" style="border: solid #000000 1pt; padding: 5pt; vertical-align: top;">
										<div dir="ltr" style="line-height: 1.2; text-align: center;">
											<span class="a">1.1.1</span>
										</div>
									</td>
									<td style="border: solid #000000 1pt; padding: 5pt; vertical-align: top;">
										<div dir="ltr" style="line-height: 1.2; text-align: center;">
											<span class="a">0x28</span>
										</div>
									</td>
									<td style="border: solid #000000 1pt; padding: 5pt; vertical-align: top;">
										<div dir="ltr" style="line-height: 1.2; text-align: center;">
											<span class="a">91</span>
										</div>
									</td>
									<td colspan="2" style="border: solid #000000 1pt; padding: 5pt; vertical-align: top;">
										<div dir="ltr" style="line-height: 1.2; text-align: center;">
											<span class="a">344</span>
										</div>
									</td>
									<td colspan="2" style="border: solid #000000 1pt; padding: 5pt; vertical-align: top;">
										<div dir="ltr" style="line-height: 1.2; text-align: center;">
											<span class="a">344</span>
										</div>
									</td>
									<td style="border: solid #000000 1pt; padding: 5pt; vertical-align: top;">
										<div dir="ltr" style="line-height: 1.2; text-align: center;">
											<span class="a">0</span>
										</div>
									</td>
								</tr>
							</tbody>
						</table>
						
			<p><a href="https://googleprojectzero.blogspot.com/2020/07/mms-exploit-part-1-introduction-to-qmage.html">Source</a></p>
			<hr id="dark">
			<h3><a href="https://github.com/DexrnZacAttack/QmageDecoder">https://github.com/DexrnZacAttack/QmageDecoder</a></h3>
			</div>  
        </div>
    </div>
</div>
<script>
	fadeBG(true);
</script>
</body>
</html>
